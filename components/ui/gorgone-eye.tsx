"use client";

import { useEffect, useRef, useState } from "react";
import { useTheme } from "next-themes";
import { cn } from "@/lib/utils";

export function GorgoneEye({ className }: { className?: string }) {
  const { theme } = useTheme();
  const [pupilPos, setPupilPos] = useState({ x: 0, y: 0 });
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleMouseMove = (e: MouseEvent) => {
      if (!containerRef.current) return;

      const rect = containerRef.current.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;

      const deltaX = e.clientX - centerX;
      const deltaY = e.clientY - centerY;

      // Limit pupil movement radius
      const maxRadius = 2; // Small movement for header logo
      const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
      
      let x = deltaX;
      let y = deltaY;

      if (distance > maxRadius) {
        const angle = Math.atan2(deltaY, deltaX);
        x = Math.cos(angle) * maxRadius;
        y = Math.sin(angle) * maxRadius;
      }

      setPupilPos({ x, y });
    };

    window.addEventListener("mousemove", handleMouseMove);
    return () => window.removeEventListener("mousemove", handleMouseMove);
  }, []);

  return (
    <div ref={containerRef} className={cn("relative flex items-center justify-center", className)}>
      {/* Pupil - Behind the eye mask but visible through the hole */}
      <div 
        className="absolute rounded-full bg-foreground/50 h-[25%] aspect-square z-0 transition-transform duration-75 ease-out"
        style={{ 
          transform: `translate(${pupilPos.x}px, ${pupilPos.y}px)`,
        }}
      />

      {/* Eye Mask SVG - The hole is transparent */}
      <svg 
        viewBox="0 0 212 97" 
        className="relative z-10 w-full h-full text-foreground fill-current"
        aria-hidden="true"
      >
        <path d="M193.38,61.79s-1.57-.32-4.46-1.41c12.35-2.95,21.29-5.59,21.29-5.59.27-.04.45-.09.45-.09,6.18-2.08-17.28-4.21-17.28-4.21,0,0-2.34-.46-6.61-2.27,3.55-1.42,5.49-1.81,5.49-1.81,0,0,23.46-2.12,17.28-4.21,0,0-.16-.04-.45-.09,0,0-14.75-4.36-32.54-8.13l-.1,1.06c9.96,2.3,19.68,4.55,28.44,6.59-5.31-.37-14.76-.36-26.1,2.64-3.04-1.69-6.5-3.83-10.34-6.52-2.47-1.73-5.1-3.7-7.86-5.92,5.04.97,10.28,2.03,15.73,3.18l.1-1.06c-6.1-1.41-12.29-2.82-18.39-4.22-2.8-2.34-5.73-4.92-8.78-7.79-.51-.48-1.01-.95-1.52-1.41-7.82-7.02-16.14-12.18-23.98-15.96-12.79-6.18-21.96-6.11-34.65,0-3.08,1.47-6.24,3.17-9.42,5.12h-.01l-.13.09c-3.86,2.38-7.76,5.14-11.56,8.3-1.48,1.21-2.94,2.51-4.37,3.86-2.75,2.59-5.4,4.94-7.95,7.1-7.09,1.62-14.33,3.27-21.45,4.91l.1,1.06c6.51-1.38,12.73-2.63,18.64-3.74-7.72,6.25-14.36,10.52-19.65,13.41-12-3.4-22.05-3.44-27.59-3.06,8.77-2.04,18.5-4.29,28.45-6.59l-.1-1.06C16.25,37.78,1.49,42.14,1.49,42.14c-.27.04-.45.09-.45.09-6.18,2.08,17.28,4.21,17.28,4.21,0,0,2.34.46,6.61,2.27-3.55,1.42-5.49,1.81-5.49,1.81,0,0-23.46,2.12-17.28,4.21,0,0,.16.04.45.09,0,0,8.94,2.64,21.29,5.59-2.89,1.09-4.46,1.4-4.46,1.4,0,0-23.46,2.12-17.28,4.21,0,0,.16.04.45.09,0,0,14.75,4.36,32.54,8.13l.1-1.06c-9.96-2.3-19.68-4.55-28.44-6.59,5.76.41,16.41.35,29.05-3.48,5.91,1.36,11.9,2.73,17.82,4.08,2.8,2.34,5.73,4.92,8.78,7.79.51.48,1.01.95,1.52,1.41,1.12,1,2.25,1.96,3.38,2.89-9.67-1.58-20.37-3.62-31.97-6.08l-.1,1.06c12.21,2.81,24.76,5.67,36.32,8.3,5.47,4,11.02,7.22,16.35,9.79,12.79,6.18,21.96,6.11,34.65,0,3.08-1.47,6.24-3.17,9.42-5.12h.01l.13-.09c1.93-1.19,3.87-2.48,5.8-3.86,12.42-2.82,26.19-5.95,39.54-9.03l-.1-1.06c-12.75,2.7-24.39,4.9-34.79,6.54.37-.3.75-.59,1.12-.89,1.48-1.21,2.94-2.51,4.37-3.86,2.75-2.59,5.4-4.94,7.95-7.1,6.9-1.57,13.95-3.19,20.88-4.78,12.65,3.83,23.3,3.88,29.07,3.48-8.77,2.04-18.5,4.29-28.45,6.59l.1,1.06c17.79-3.77,32.55-8.13,32.55-8.13.27-.04.45-.09.45-.09,6.18-2.08-17.28-4.21-17.28-4.21ZM45.63,48.18c-.32.23-.63.44-.94.66-.1-.04-.19-.09-.29-.13.41-.17.82-.35,1.23-.53ZM25.72,59.67c-6.59-1.53-12.98-3.01-18.91-4.39,5.31.37,14.76.36,26.1-2.64.99.55,2.04,1.17,3.11,1.81-4.17,2.44-7.63,4.1-10.31,5.21ZM37.94,62.42c2.11-.7,4.28-1.51,6.48-2.44,2.13,1.52,4.36,3.21,6.7,5.09-4.24-.81-8.64-1.7-13.18-2.65ZM71.53,63.25c-4.95-2.15-9.86-4.77-14.7-7.87-.5-.32-1-.62-1.5-.93.87-.52,1.75-1.05,2.63-1.62,2.46-1.58,4.95-3.04,7.45-4.36,3.49-1.87,7.01-3.5,10.56-4.88-.88,8.29,1.79,16.95,6.76,23.66-3.75-1.07-7.48-2.4-11.19-4.01ZM118.86,69.29c-.27.05-.55.1-.82.15-9.34,1.5-18.74,1.34-28.07-.45-8.87-6.18-10.86-18.38-6.52-27.9,3.39-.98,6.79-1.75,10.21-2.28,12.11-1.94,24.32-1.11,36.35,2.48,1.41,2.62,2.24,5.58,2.28,8.86-.14,8.8-5.89,15.39-13.42,19.15ZM153.74,55.38c-2.46,1.58-4.95,3.04-7.45,4.36-5.43,2.92-10.94,5.22-16.5,6.94,2.28-4.63,3.57-10.21,3.47-16.55.08-2.72-.15-5.42-.64-8.04,2.53.84,5.04,1.79,7.55,2.87,4.95,2.15,9.86,4.77,14.7,7.87.5.32,1,.62,1.5.93-.87.52-1.75,1.05-2.63,1.62ZM167.29,48.23s0,0-.01,0c-.01,0-.03-.02-.04-.03.02,0,.03.02.05.02ZM158.77,65.63c2.9-2.35,5.65-4.42,8.23-6.24.16.07.32.15.47.22,2.53,1.1,5,2.02,7.41,2.82-5.59,1.17-10.97,2.24-16.11,3.2ZM175.67,53.77c.95-.56,1.87-1.08,2.75-1.56,12,3.4,22.05,3.44,27.59,3.06-5.94,1.38-12.32,2.86-18.91,4.39-2.91-1.21-6.76-3.08-11.43-5.89Z"/>
      </svg>
    </div>
  );
}

